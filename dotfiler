#!/bin/bash

###
# Bootstrapping script
#
# Current unboxing time - 0:50
# Dependencies
# - Xcode
# - MAMP
# - Sublime Text 3
###

# Setup ------------------------------------------------------------ /

# Ask password upfront
sudo -v

DOTFILES=~/dotfiles
PACKAGES=$DOTFILES/scripts/packages

# Load colorized output
source $DOTFILES/helpers/colorizer.sh

# Update ----------------------------------------------------------- /

header "Updating core files"

# Update core repository
cd $DOTFILES
git fetch -q origin master
git pull -q origin master

# Synchronize folders
rsync --exclude ".git/" --exclude "scripts" --exclude "bootstrap.sh" --exclude "README.md" -a . ~
success "Scripts and profiles updated"

# Move binary
chmod +x ~/dotfiler
mv ~/dotfiler /usr/local/bin/dotfiler
success "Binary updated"

# Commands --------------------------------------------------------- /

case "$1" in

  # Install dependencies
  setup)
    if [ ! -f "$HOME/.aliases" ]; then
      source $DOTFILES/scripts/setup.sh
    fi
  ;;

  # Update and sync dependencies
  update)
    source $DOTFILES/scripts/update.sh
  ;;

  # Remove Dotfiler
  uninstall)
    source $DOTFILES/scripts/uninstall.sh
  ;;

  # Reinstall Dotfiler
  reinstall)
    source $DOTFILES/scripts/uninstall.sh
    source $DOTFILES/scripts/setup.sh
    source $DOTFILES/scripts/update.sh
  ;;
esac
